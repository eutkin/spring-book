



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>ООП - Spring Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Spring Guide" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Spring Guide
              </span>
              <span class="md-header-nav__topic">
                ООП
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Spring Guide" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Spring Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../archicture/" title="Архитектура. Часть 1" class="md-nav__link">
      Архитектура. Часть 1
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../archicture2/" title="Архитектура. Часть 2" class="md-nav__link">
      Архитектура. Часть 2
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../a1/" title="Архитектура. Практика" class="md-nav__link">
      Архитектура. Практика
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../interface/" title="Разработка интерфейсов" class="md-nav__link">
      Разработка интерфейсов
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ООП
      </label>
    
    <a href="./" title="ООП" class="md-nav__link md-nav__link--active">
      ООП
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="Классическое ООП, которое мы все знаем" class="md-nav__link">
    Классическое ООП, которое мы все знаем
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="Почему классическое ООП умерло?" class="md-nav__link">
    Почему классическое ООП умерло?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="Маленький жизненный пример" class="md-nav__link">
    Маленький жизненный пример
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="Что не так с кодом" class="md-nav__link">
    Что не так с кодом
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="Наличие состояние и многопоточность." class="md-nav__link">
    Наличие состояние и многопоточность.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="Неявность состояния и поведения." class="md-nav__link">
    Неявность состояния и поведения.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="Проблема с компизицией объектов" class="md-nav__link">
    Проблема с компизицией объектов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="Отсутствие гибкости" class="md-nav__link">
    Отсутствие гибкости
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="Резюме" class="md-nav__link">
    Резюме
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-gen" title="ООП next gen" class="md-nav__link">
    ООП next gen
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" title="Наследование" class="md-nav__link">
    Наследование
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="Стиль программирования" class="md-nav__link">
    Стиль программирования
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="Композиция объектов и интерфейсы" class="md-nav__link">
    Композиция объектов и интерфейсы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="Резюме" class="md-nav__link">
    Резюме
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ioc/" title="Spring IoC" class="md-nav__link">
      Spring IoC
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../qa/" title="QA" class="md-nav__link">
      QA
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="Классическое ООП, которое мы все знаем" class="md-nav__link">
    Классическое ООП, которое мы все знаем
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="Почему классическое ООП умерло?" class="md-nav__link">
    Почему классическое ООП умерло?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="Маленький жизненный пример" class="md-nav__link">
    Маленький жизненный пример
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="Что не так с кодом" class="md-nav__link">
    Что не так с кодом
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="Наличие состояние и многопоточность." class="md-nav__link">
    Наличие состояние и многопоточность.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="Неявность состояния и поведения." class="md-nav__link">
    Неявность состояния и поведения.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="Проблема с компизицией объектов" class="md-nav__link">
    Проблема с компизицией объектов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="Отсутствие гибкости" class="md-nav__link">
    Отсутствие гибкости
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="Резюме" class="md-nav__link">
    Резюме
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-gen" title="ООП next gen" class="md-nav__link">
    ООП next gen
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" title="Наследование" class="md-nav__link">
    Наследование
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="Стиль программирования" class="md-nav__link">
    Стиль программирования
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="Композиция объектов и интерфейсы" class="md-nav__link">
    Композиция объектов и интерфейсы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="Резюме" class="md-nav__link">
    Резюме
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">Современное ООП или почему классическое ООП мертво?<a class="headerlink" href="#_1" title="Permanent link">#</a></h1>
<h2 id="_2">Классическое ООП, которое мы все знаем<a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>Как объясняют ООП в большинстве случаев? </p>
<p>Есть класс <code>Animal</code>, от него наследуются <code>Cat</code> и <code>Dog</code>. У животного есть имя,на которое оно отзывается, а так же
все животные умеют бегать.</p>
<div class="codehilite"><pre><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Animal</span> <span class="o">{</span>

   <span class="kd">protected</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

   <span class="kd">protected</span> <span class="nf">Animal</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">();</span>

   <span class="kd">public</span> <span class="nf">respondName</span><span class="o">(</span><span class="n">String</span> <span class="n">anyName</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">anyName</span><span class="o">))</span> <span class="o">{</span>
           <span class="n">run</span><span class="o">();</span>
       <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Cat</span> <span class="kd">extends</span> <span class="n">Animal</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">Cat</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Дык дык дык&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">climbTree</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// cat can to climb a tree</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Dog</span> <span class="kd">extends</span> <span class="n">Animal</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">Cat</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;*звук бегающей собаки*&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">bringBall</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// dog can bring the ball</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Animal</span> <span class="n">animal</span> <span class="o">:</span> <span class="n">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Cat</span><span class="o">(</span><span class="s">&quot;Barsik&quot;</span><span class="o">,</span> <span class="n">RED</span><span class="o">),</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">(</span><span class="s">&quot;GoodBoy&quot;</span><span class="o">,</span> <span class="n">BLUE</span><span class="o">)))</span> <span class="o">{</span>
          <span class="n">animal</span><span class="o">.</span><span class="na">respondName</span><span class="o">(</span><span class="s">&quot;Barsik&quot;</span><span class="o">);</span>        
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// printed: Дык дык дык</span>
</pre></div>


<p>Каждый класс представляет собой объект реального мира, у которого есть какие-то характеристики и поведение. </p>
<p>В этом примере кода можно увидеть все принципы ООП:</p>
<ul>
<li>Наследование. Кошка и собака наследуют все черты, характерные для класса Животные, который мы описали. Они не 
только могут откликаться на свои имя и  бегать, но и имеют уникальные черты, например, кошка может забираться 
на дерево, а собака - приносить мячик.</li>
<li>Инкапсуляция. Здесь инкапулирован поле с именем, его значение вне класса мы получить не можем.</li>
<li>Полиморфизм. Не зависимо от типа животного, кошка или собака, мы можем окликнуть их по имени, так как это 
свойственно классу Животные.</li>
<li>Абстракция. При создании классов мы взяли только свойства и поведение, которые нам необходимы, а не описывали
все детально. То есть, наш класс Животное - это некая абстракция над реальным животным, над объектом реального мира.</li>
</ul>
<p>Не так сложно, да? Но что же могло пойти не так...</p>
<h2 id="_3">Почему классическое ООП умерло?<a class="headerlink" href="#_3" title="Permanent link">#</a></h2>
<h3 id="_4">Маленький жизненный пример<a class="headerlink" href="#_4" title="Permanent link">#</a></h3>
<p>Вы устроились на работу программистом Java и ваше первое большое и ответственное задание - написать с коллегой
REST сервис, который отдает информацию о офисных работниках фирмы. Информация об работниках лежит в текстовых файлах 
на файловом сервере компании. Ваш коллега должен написать REST часть (ок, гугл, что такое REST), а ваша задачи прочитать
из файлов работников.</p>
<p>Так, погодите, а где кошечки и собачки? Эй? Хм, хорошо. у нас есть хотя бы класс Работник, да? Отлично, давайте
напишем для него класс.</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span> 
</pre></div>


<p>Так, мы создали класс, добавили туда пару полей, заинкапсулировали их. Осталось добавить пару действий, которые
могут выполнять наши работники и все будет отлично. Хм. Но какие действия могут выполнять работники, если нам 
необходимо только получить только содержание полей?</p>
<p>Так, мы же пишем REST сервис, а он обычно отдает информацию
в JSON (другие программисты говорили об этом в курилке). Добавим метод для конвертации работника
в json, как раз прям классика будет:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJson</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;{\&quot;id\&quot;: &quot;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&quot;, \&quot;name\&quot; : &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot; }&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span> 
</pre></div>


<p>А что у нас говорит ООП? Классы моделируют объекты реального мира, а умеют ли у нас работник компании
преобразовывать себя в Json? Что-то сомнительно. Но это мелочи жизни, давайте пойдем дальше.</p>
<p>Работники у нас хранятся в файлах и нам их надо оттуда достать. Давайте подумаем, как это сделать в рамках
классического ООП.</p>
<p>Если мы добавили метод для преобразования данных в json, почему бы не добавить метод для чтения
работника из файла? Нет, это глупо, работник же не может сам себя вычитать из файла. Значит, это должен делать
кто-то другой. Но мы можем сделать конструктор для класс Работник, который принимает строку из файла.</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">String</span> <span class="n">line</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJson</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;{\&quot;id\&quot;: &quot;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&quot;, \&quot;name\&quot; : &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot; }&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span> 
</pre></div>


<p>Так как ООП говорит нам моделировать реальные объекты, то создадим интерфейс Archive:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IArchive</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>

     <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getObjects</span><span class="o">();</span>

<span class="o">}</span>
</pre></div>


<p>С энтузиазмом пишем сначала абстрактный класс и его наследника, который будет читать только работников из файла
'employees.csv'.</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Archive</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">Archive</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">readFromFiles</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// здесь реализовано неблокирующее чтение.</span>
        <span class="c1">// писать я его не буду, потому что это сложнее, чем привычное блокирующее чтение из файла</span>
        <span class="c1">// но неблокирующее выбрано, чтобы не создавать непреодолимых узких мест в системе,</span>
        <span class="c1">// так как мы дальше коснемся многопоточки и производительности</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lines</span> <span class="o">=</span> <span class="n">unlockableReadLines</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getObjects</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">readFromFiles</span><span class="o">();</span>
        <span class="n">parseLine</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">objects</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">parseLine</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeArchive</span> <span class="kd">extends</span> <span class="n">Archive</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">EmployeeArchive</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">&quot;employees.csv&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nf">parseLine</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="kd">super</span><span class="o">.</span><span class="na">lines</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">employees</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">line</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">objects</span> <span class="o">=</span> <span class="n">employees</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>А ваш коллега тем временем написать REST часть.</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">IArchive</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">archive</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">EmployeeServlet</span><span class="o">(</span><span class="n">IArchive</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">archive</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">archive</span> <span class="o">=</span> <span class="n">archive</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="na">getObjects</span><span class="o">();</span>

        <span class="n">StringJoiner</span> <span class="n">sj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringJoiner</span><span class="o">(</span><span class="s">&quot;[&quot;</span><span class="o">,</span> <span class="s">&quot;]&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span> <span class="o">:</span> <span class="n">employees</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sj</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">toJson</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">res</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sj</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Проанализируем написанное с точки зрения классического ООП.</p>
<p>У класса Архив есть состояние (прочитанные строки и распарсенные в объекты работники) и поведение -- публичный
метод получить объекты из архива, скрытые от внешних глаз (привет, инкапсуляция) методы для чтения файла и 
абстрактный метод для парсинга из текста в объекты, который мы реализуем в класса Архив Работников. Все отлично.</p>
<p>Вы радостно пишите коллеге, что закончили свою часть и даже больше (вы еще же добавили метод по конвертации в 
json!) и коммитите ваш код в репозиторий проекта.</p>
<p>Ваш коллега используя сервлет и томкат (про которые вы тоже слышали) и используя ваш кода дописывает сервис. </p>
<p>Вы с коллегой довольные собой 
<img alt="oop1" src="../img/oop1.jpg" /></p>
<p>В чем же причина? Сервлеты на каждый запрос используют новый тред (но они подло делают у вас за спиной), 
а ваш класс не синхронизирован. Справедливо, правим наш класс Архив:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Archive</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">Archive</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">readFromFiles</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// здесь реализовано неблокирующее чтение.</span>
        <span class="c1">// писать я его не буду, потому что это сложнее, чем привычное блокирующее чтение из файла</span>
        <span class="c1">// но неблокирующее выбрано, чтобы не создавать непреодолимых узких мест в системе,</span>
        <span class="c1">// так как мы дальше коснемся многопоточки и производительности</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lines</span> <span class="o">=</span> <span class="n">unlockableReadLines</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getObjects</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// (1)</span>
        <span class="n">readFromFiles</span><span class="o">();</span>
        <span class="n">parseLine</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">objects</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">parseLine</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<p>Теперь вызывать метод (1) может только один поток и теперь падать ничего не должно. Отдаем на тесты и сервис не 
проходит нагрузчное тестирование. Так как теперь все треды ждут, пока один из них прочитает данные из файла.</p>
<p>Так как файл читается неблокирующее, то мы принимаем решение создавать на каждый запрос (он же тред) свой экземпляр
объекта <code>EmployeeArchive</code>, что решает проблему, правда ценой б<em>о</em>льшими затратами ОЗУ, так как каждый тред будет 
держать в памяти две коллекции - работники как строки и как объекты.</p>
<p>Ок, проблему с производительностью мы кое как решили. Мирные жители засыпают, просыпается мафия (бизнес). И бизнес
говорит, что теперь отдавать данные о работниках надо отдавать не только в json, но и в xml. Плюс ко всему этому, 
пришел третий программист, и вместо файлов для хранения работников он использовать базу данных.</p>
<p>И что нам остается? Добавлять на каждый формат по методу в работника? И по конструктору для каждого способа чтения?
Тогда остается это пенести в отдельные классы, а наш класс Работник остается совсем без поведения.</p>
<p>В итоге наши классы разделились по сути на поведение и данные. </p>
<h3 id="_5">Что не так с кодом<a class="headerlink" href="#_5" title="Permanent link">#</a></h3>
<p><em>Перед чтением причин 'а что не так' следует отметить, что приведенный пример кода довольно простой.
Из этого следует, что некоторые перечисленные ниже минусы будут не настолько очевидны, как хотелось бы
автору сего опуса, за что прошу меня извинить.</em></p>
<h4 id="_6">Наличие состояние и многопоточность.<a class="headerlink" href="#_6" title="Permanent link">#</a></h4>
<p>Большой процент сервисов (написанных на яве) работают многопоточно (например, томкат и аналоги создают на каждый 
запрос поток (thread), причем создают неявно). При многопоточности нам надо синхронизировать состояние между потоками.
Это ведет к усложнению кода, к просадке производительности (потому что потоков много, а объект синхронизации один) и 
другим неприятным вещам, которыми пугают детей программистов</p>
<p><img alt="Screenshot" src="../img/opp2.jpg" /></p>
<h4 id="_7">Неявность состояния и поведения.<a class="headerlink" href="#_7" title="Permanent link">#</a></h4>
<p>Неявность в данном случае - это отсутствие возможности быстро 
определить в каком состоянии объект или что будет результатом работы его метода. Это сильно влияет на читаемоесть 
кода, его понимание и восприятие другим человеком. Будучи начинающим программистом вы писали код для себя. Теперь
вы пишите его для других и поэтому важно, чтобы ваш код был понятен не-программисту.</p>
<p>Разберем несколько подробней. Неявность состояния. </p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span> 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="na">getObjects</span><span class="o">();</span> <span class="c1">// (1)</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Допустим, поток, в котором мы выполняем метод (1) был прерван (interrupted). В каком состоянии находится объект 
<code>archive</code>? Что будет, если мы вызовем метод (1) еще раз? У нас не ответа на эти вопросы.  </p>
<p>Другая проблема заключается в сложности реализации. Если в вашем классе несколько полей, и эти поля используются 
в разных методах (один метод пишет в поле, читает в другое и так далее), то очень тяжело понять последовательность 
этих шагов, не вдаваясь глубоко в детали. Алгоритм работы класса "размывается" по всему классу, и для понимания его 
работы необходимо внимательно изучить все содержимое. Это занимает достаточно большое время и человек уже забывает, 
зачем ему вообще сдался ваш класс.</p>
<h4 id="_8">Проблема с компизицией объектов<a class="headerlink" href="#_8" title="Permanent link">#</a></h4>
<p>Что такое композиция объектов? По сути это когда один объект типа А имеет поле с типом В:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">some.B</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>

    <span class="n">B</span> <span class="n">field</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>


<p>Композицию называют еще делегированием, так как часть задач внутри класса мы можем делегировать классу В, например:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">some.B</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>

    <span class="n">B</span> <span class="n">field</span><span class="o">;</span>

    <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Logic by class A&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">someVar</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">doAnotherAction</span><span class="o">();</span> <span class="c1">// делегируем расчет переменной классу В</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Logic by class А &quot;</span> <span class="o">+</span> <span class="n">someVar</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Так же еще называют поле field класса А зависимостью типа B.</p>
<p>Так вот, в чем же проблема при классическом ООП и композицией?</p>
<p>А нет у нас композиции в классическом ООП, мухаха *злобно хохочет*. А как же так, спросите вы? А ООП ответит, но у 
вас же есть наследование и раз вам так нужен класс В, просто отнаследуйтесь от него.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">A</span> <span class="kd">extends</span> <span class="n">B</span> <span class="o">{</span>

    <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Logic by class A&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">someVar</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">doAnotherAction</span><span class="o">();</span> <span class="c1">// делегируем расчет переменной классу В</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Logic by class А &quot;</span> <span class="o">+</span> <span class="n">someVar</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>А представьте, что В имеет кучу полей и других завимостей, которые надо инициализировать, либо кучу методов, которые
нам и не нужны особо и так далее. Я, конечно, передергиваю, но композиции нет в принципах ООП, а наследование есть. 
И самое забавное, что в современном мире мы используем композицию везде, а наследование в столь редких случаях, 
что это даже забавно.</p>
<p>Если посмотреть более реалистичные примеры:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeHandler</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObjectVisitor</span> <span class="n">visitor</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SomeHandler</span><span class="o">(</span><span class="n">JsonObjectVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">visitor</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">JsonObject</span> <span class="n">json</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">);</span>
       <span class="k">if</span> <span class="o">(</span><span class="s">&quot;department&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
           <span class="k">for</span> <span class="o">(</span><span class="n">Json</span> <span class="n">obj</span> <span class="o">:</span> <span class="n">json</span><span class="o">.</span><span class="na">getJsonArray</span><span class="o">())</span> <span class="o">{</span> 
               <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="na">visit</span><span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="na">asJsonObject</span><span class="o">());</span>
               <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
           <span class="o">}</span>
       <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getResult</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">values</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Здесь одновременно используется и композиция (<code>SomeHandler</code> зависит от <code>JsonObjectVisitor</code>) и состояние (<code>values</code>).
Чтобы этот класс хоть как-то работал, нам на каждый вызов метода <code>handle</code> надо создавать новый объект класса 
<code>SomeHandler</code>. Но поле <code>visitor</code> у нас неизменяемое и мы должны хранить ссылку на <code>JsonObjectVisitor</code> в каждом объекте.
Что не так уж оптимально. Исходя из этого, видно, что композиция и классическое ООП с состоянияем не так сильно 
стыкаются между собой. Коночно, количество ссылок это мелочи и является больше придиркой, но все равно создает
впечатление неправильного дизайна, которое не дает засыпать вам каждой ночью.</p>
<h4 id="_9">Отсутствие гибкости<a class="headerlink" href="#_9" title="Permanent link">#</a></h4>
<p>У объекта есть поведение. В классическом ООП это поведение не отделимо от данных. Изменения требований
заставляют нас это поведение менять, то сделать этого, не подвергнув всю систему риску ошибки, мы не можем. Более того,
если в разных местах надо использовать и старый и новый варианты метода, то задача и вовсе становится не разрешимой.</p>
<h3 id="_10">Резюме<a class="headerlink" href="#_10" title="Permanent link">#</a></h3>
<p>Так почему же классическое ООП умерло? Да потому что те идеи, которые были заложены 20+ лет назад с течением времени
оказались не так хорошие и удобны в использовании. </p>
<p>Главная причина смерти классического ООП заключается в том, что система со временем вынуждена подстраиваться под 
новые требования, но сделать этого не может из-за тесной связи данных и поведения. </p>
<p>Наличие же состояния стало проблемой в многопоточности. Да, 20+ лет назад, 
когда ядро процессора было всего одно это было ок, никто не загонялся этим. А теперь, когда ядер процессоров в 
телефонах уже 8 и больше, игнорировать многопоточность стало невозможно.</p>
<p>Сама идея использования состояния и поведения, его использующее, тоже оказалась не такой приятной, так 
как при усложнении логики, систем в целом, такой код стал читаться и восприниматься гораздо сложнее. Да и использовать
его не очень удобно.</p>
<p>Поэтому, никто такой код уже не пишет (за редким исключением), просто многие уже даже не задумываются, как далеко
мы ушли от заветов *дедушки Ленина*</p>
<h2 id="next-gen">ООП next gen<a class="headerlink" href="#next-gen" title="Permanent link">#</a></h2>
<p>Так, классическое ООП у нас мертво, так как же писать? Что взамен? А взамен у нас переосмысление принципов ООП с 
неплохой такой примесью функционального программирования. </p>
<h3 id="_11">Наследование<a class="headerlink" href="#_11" title="Permanent link">#</a></h3>
<p>Ушло наследование. Конечно, во всех учебниках оно есть и официально никуда не ушло. Оно ушло из кода как 
принцип. Потому что принцип подразумевает свое использование гораздо чаще, чем те 5 классов у тебя в проекте,
3 из которых являются абстрактными, чтобы код не дублировать.</p>
<h3 id="_12">Стиль программирования<a class="headerlink" href="#_12" title="Permanent link">#</a></h3>
<p>Функциональная парадигма заменила процедурную. Как выглядит процедурная парадигма в жизни:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcedureIsBad</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">));</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">procedure</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
        <span class="k">this</span><span class="o">.</span><span class="na">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="c1">// когда мы вместо Integer используем int, </span>
        <span class="c1">// то компилиятор превращает int в Integer.</span>
        <span class="c1">// Это называется auto-boxing. Теперь вы знаете больше (а может и нет, откуда мне знать)       </span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">procedure</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">anotherList</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (2)</span>
        <span class="n">anotherList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>То есть, у нас есть методы, которые меняют состояние памяти (состояние объектов, они уже нас в памяти хранятся). 
Их легко узнать, потому что они чаще всего ничего не возвращают (<code>void</code>). Почему процедурная парадигма в контексте
ООП и java в частности это плохо? Потому что процедуры тяжело воспринимаются. Чтобы проиллюстрировать, давайте 
посмотрим на пример использования процедур:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span> <span class="c1">// А зачем создавать новый список, а не просто использовать</span>
      <span class="c1">// asList? Потому что коллекцию, которую возвращает метод asList нельзя модифицировать</span>

      <span class="n">addElem</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
      <span class="n">sort</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">DESC</span><span class="o">);</span>

      <span class="c1">// Здесь куча другого кода</span>




      <span class="c1">// Серьезно, прям куча</span>

      <span class="n">filter</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>

      <span class="c1">// А теперь вспомни, что у тебя в этом листе.</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>А давайте теперь в этом примере заменим процедурную парадигму на функциональную:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span> 

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">updatedList</span> <span class="o">=</span> <span class="n">addElem</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">sortedList</span> <span class="o">=</span> <span class="n">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">DESC</span><span class="o">);</span>

      <span class="c1">// Здесь куча другого кода</span>




      <span class="c1">// Серьезно, прям куча</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">filteredList</span> <span class="o">=</span> <span class="n">filter</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>

      <span class="c1">// А теперь вспомни, что у тебя в этом листе.</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">filteredList</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Функциональная парадигма здесь больше касается сигнатур методов, в java никто особо не заморачивается с 
неизменяемостью (immutablity) объектов и side эффектами. </p>
<div class="codehilite"><pre><span></span>Immutablity — способ написания классов, чье состояние невозможно изменить. Если очень хочется, то создается
такой же объект, но уже с нужными изменениями. Immutablity — когда в мире сдвигается камень, пересоздается Вселенная.

Side-effect — когда функция (метод) меняет чье-либо состояние. Фунцкия, которая не меняет чье-то состояние, называется
pure-функция \*расово верная функция*
</pre></div>


<p>Главное отличие данного способа от процедурного заключается в том, что метод возвращает результат своей работы. 
Даже если он просто изменил состояние переданного списка. Менять состояние вместо создания нового, конечно, 
не рекомендуется, но на практике каких-то особых последствий замечено не было, так как первоначальный вариант 
переменной обычно больше нигде не используется и покорно ждет сборщика мусора. </p>
<p>Почему так важно возвращать результат?</p>
<p>Во-первых, нам не надо работать с изменяющимся состоянием. Мы получаем данные на вход, обрабатываем, отдаем на выход. 
Если же данные надо где-то хранить, то это не головная боль метода-обработчика, 
так как принцип Единой Ответственности никто не отменял. </p>
<p>Во-вторых, мы получаем обратную связь при использовании метода. Если использование процерного стиля схоже с бросанием
камня в бездонный колодец и непонятно, произошло ли хоть что-нибудь, то при использововании фунционального - 
мы обязательно услышим всплеск. И сразу становится спокойнее, так как мы видим результат своих действий.   </p>
<p>А еще мы могли бы делать композицию функций или function chain (когда функции вызываются друг за другом), но синтаксис
явы слишком уродлив для этого. </p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span> 

      <span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">addElemFunc</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-&gt;</span> <span class="n">addElem</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">sortFunc</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-&gt;</span> <span class="n">sort</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">DESC</span><span class="o">);</span>
      <span class="n">UnaryOperator</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">filterFunc</span> <span class="o">=</span> <span class="n">Main</span><span class="o">::</span><span class="n">filter</span><span class="o">;</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">filteredList</span> <span class="o">=</span> <span class="n">addElemFunc</span><span class="o">.</span><span class="na">andThen</span><span class="o">(</span><span class="n">sortFunc</span><span class="o">).</span><span class="na">andThen</span><span class="o">(</span><span class="n">filterFunc</span><span class="o">).</span><span class="na">apply</span><span class="o">(</span><span class="n">list</span><span class="o">);</span> <span class="c1">// function chain</span>

      <span class="c1">// А теперь вспомни, что у тебя в этом листе.</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">filteredList</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p><img alt="Screenshot" src="../img/oop3.jpg" /></p>
<h3 id="_13">Композиция объектов и интерфейсы<a class="headerlink" href="#_13" title="Permanent link">#</a></h3>
<p>Если мы отказываемся от изменяемого состояния в классах (напомню, что Data Transfer Object, объекты для переноса данных,
классами являются только формально, так как не имеют никакого поведения и служат как кванты информации), используя 
функциональный стиль программирования, то композицию использовать становится проще. </p>
<p>Более того, если мы не 
предусматриваем смену делегата (значения поля), то объект можно создать с неизменяемым состоянием. Если что-то не 
меняется, значит не сломается. </p>
<p>Тогда получаем, что у нас есть класс с некоторой логикой, состояние которого зависит
от состояния его зависимостей. А если все зависимости будут написаны по тем же принципам, то и сама система будет
очень стабильной. </p>
<p>Пример:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeHandler</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObjectVisitor</span> <span class="n">visitor</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SomeHandler</span><span class="o">(</span><span class="n">JsonObjectVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">visitor</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">handle</span><span class="o">(</span><span class="kd">final</span> <span class="n">JsonObject</span> <span class="n">json</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">);</span>
       <span class="k">if</span> <span class="o">(</span><span class="s">&quot;department&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
           <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
           <span class="k">for</span> <span class="o">(</span><span class="n">Json</span> <span class="n">obj</span> <span class="o">:</span> <span class="n">json</span><span class="o">.</span><span class="na">getJsonArray</span><span class="o">())</span> <span class="o">{</span> 
               <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="na">visit</span><span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="na">asJsonObject</span><span class="o">());</span>
               <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
           <span class="o">}</span>
           <span class="k">return</span> <span class="n">values</span><span class="o">;</span>
       <span class="o">}</span>
       <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Мы избавились от изменяемого состояния класса, которое зависит теперь только от состояния объекта <code>visitor</code>.
Если при вызове метода класса пойдет что-то не так, например, произойдет прерывание потока (interrupt thread),
то мы можем дальше использовать этот объект, вызвав метод еще раз, а не гадая, в каком он состоянии.</p>
<p>При композиции объектов, ссылаться можно только на интерфейсы:</p>
<div class="codehilite"><pre><span></span><span class="kd">interface</span> <span class="nc">B</span> <span class="o">{}</span>
<span class="kd">interface</span> <span class="nc">A</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">AImpl</span> <span class="kd">implements</span> <span class="n">A</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">B</span> <span class="n">requiredDependency</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">B</span> <span class="n">optionalDependency</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AImpl</span><span class="o">(</span><span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">requiredDependency</span> <span class="o">=</span> <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AImpl</span> <span class="nf">setOptionalDependency</span><span class="o">(</span><span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">optionalDependency</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Все зависимости класса делятся на две группы:</p>
<ul>
<li>Обязательные. Без них выполнение задачи классом невозможно.</li>
<li>Опциональные. Являются вспомогательными, успешность выполнение задачи классом от них не зависит</li>
</ul>
<p>Например:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorService</span> <span class="kd">implements</span> <span class="n">Service</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// Обязательная зависимость. Без репозитория мы с авторами не сможем работать</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AuthorRepository</span> <span class="n">authorRepository</span><span class="o">;</span>

    <span class="c1">// Опциональная. Если его нет, значит кидаем RuntimeException</span>
    <span class="kd">private</span> <span class="n">SQLExceptionTranslator</span> <span class="n">translator</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AuthorService</span><span class="o">(</span><span class="n">AuthorRepository</span> <span class="n">authorRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorRepository</span> <span class="o">=</span> <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">authorRepository</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AuthorService</span> <span class="nf">setTranslator</span><span class="o">(</span><span class="n">SQLExceptionTranslator</span> <span class="n">translator</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">translator</span> <span class="o">=</span> <span class="n">translator</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="nf">findAuthor</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">authorRepository</span><span class="o">.</span><span class="na">findByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">translator</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="n">translator</span><span class="o">.</span><span class="na">translate</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Из правила "ссылаться можно только на интерфейсе" следует, что каждый класс должен реализовывать интерфейс.</p>
<h2 id="_14">Резюме<a class="headerlink" href="#_14" title="Permanent link">#</a></h2>
<p>Мы немного вспомнили классическое ООП, знакомое каждому программисту. Кошечки, собачки 
и <a href="https://projects.haykranen.nl/java/">InterpreterClientDecoratorMapper</a>.</p>
<p>Мы разобрали недостатки подходов классического ООП, из-за которых незаметно для окружающих оно мутировало в нечто 
среднее функциональным и классическим ООП подходами. Да, есть люди, пишущее еще в классическом виде, но обычно
это код очень больно поддерживать и их в тайне все ненавидят (как не парадоксально, даже те, кто сам так пишет).</p>
<p>В этой главе мы описали не то, как сейчас все пишут код, а к чему надо стремиться, чтобы писать гибкие, понятные и 
поддерживаемые системы. </p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../interface/" title="Разработка интерфейсов" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Разработка интерфейсов
              </span>
            </div>
          </a>
        
        
          <a href="../ioc/" title="Spring IoC" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Spring IoC
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a353778b.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>